<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„É°„É≥„Çø„É´„Éò„É´„ÇπÁõ∏Ë´áÁ™ìÂè£Ë®∫Êñ≠</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Hiragino Sans', 'Meiryo', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            min-height: 500px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #4a5568;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #718096;
            font-size: 1.1rem;
        }
        
        /* „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº */
        .progress-container {
            margin-bottom: 30px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .step-counter {
            font-size: 0.9rem;
            color: #718096;
            font-weight: bold;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 25%;
        }
        
        /* Ë≥™Âïè„Ç´„Éº„Éâ */
        .question-step {
            display: none;
        }
        
        .question-step.active {
            display: block;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .question-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .options {
            list-style: none;
            margin-bottom: 30px;
        }
        
        .option {
            margin: 15px 0;
        }
        
        .option label {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .option label:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }
        
        .option input[type="radio"] {
            margin-right: 15px;
            transform: scale(1.3);
            accent-color: #667eea;
        }
        
        .option input[type="radio"]:checked + span {
            color: #667eea;
            font-weight: bold;
        }
        
        .option label:has(input:checked) {
            border-color: #667eea;
            background: #f0f4ff;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        /* „Éú„Çø„É≥ */
        .button-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .btn-back {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn-back:hover:not(:disabled) {
            background: #cbd5e0;
            transform: translateY(-2px);
        }
        
        .btn-next {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-next:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 15px 30px;
            font-size: 1.1rem;
        }
        
        .btn-submit:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
        }
        
        /* ÁµêÊûúË°®Á§∫ */
        .result-card {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            display: none;
        }
        
        .result-card.show {
            display: block;
            animation: slideIn 0.5s ease;
        }
        
        .result-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .service-info {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .contact-info {
            background: rgba(255,255,255,0.9);
            color: #333;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .contact-btn {
            background: #38a169;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 5px 0;
            transition: all 0.3s ease;
        }
        
        .contact-btn:hover {
            background: #2f855a;
            transform: translateY(-1px);
        }
        
        .loading {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .restart-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .restart-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
                margin: 10px 0;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .question-title {
                font-size: 1.2rem;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <h1>üå± „É°„É≥„Çø„É´„Éò„É´„ÇπÁõ∏Ë´áÁ™ìÂè£Ë®∫Êñ≠</h1>
                <p>„ÅÇ„Å™„Åü„Å´ÊúÄÈÅ©„Å™Áõ∏Ë´áÁ™ìÂè£„Çí„ÅîÊèêÊ°à„Åó„Åæ„Åô</p>
            </div>
            
            <!-- „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº -->
            <div class="progress-container">
                <div class="progress-info">
                    <div class="step-counter">Ë≥™Âïè <span id="currentStep">1</span> / 4</div>
                    <div style="color: #718096; font-size: 0.9rem;" id="progressPercent">25%</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            
            <!-- Ë≥™Âïè„Çπ„ÉÜ„ÉÉ„Éó -->
            <div id="questionContainer">
                <!-- Ë≥™Âïè1: Á∑äÊÄ•Â∫¶ -->
                <div class="question-step active" data-step="1">
                    <div class="question-title">‰ªä„ÅÆ„ÅÇ„Å™„Åü„ÅÆÁä∂Ê≥Å„ÅØÔºü</div>
                    <ul class="options">
                        <li class="option">
                            <label>
                                <input type="radio" name="urgency" value="emergency">
                                <span>üö® ‰ªä„Åô„ÅêË™∞„Åã„Å®Ë©±„Åó„Åü„ÅÑ„ÉªÂç±Èô∫„ÇíÊÑü„Åò„Çã</span>
                            </label>
                        </li>
                        <li class="option">
                            <label>
                                <input type="radio" name="urgency" value="urgent">
                                <span>‚ö° Êï∞Êó•‰∏≠„Å´„ÅØÁõ∏Ë´á„Åó„Åü„ÅÑ</span>
                            </label>
                        </li>
                        <li class="option">
                            <label>
                                <input type="radio" name="urgency" value="normal">
                                <span>üïê ÊôÇÈñì„Çí„Åã„Åë„Å¶„Åò„Å£„Åè„ÇäÁõ∏Ë´á„Åó„Åü„ÅÑ</span>
                            </label>
                        </li>
                        <li class="option">
                            <label>
                                <input type="radio" name="urgency" value="prevention">
                                <span>üå± ‰∫àÈò≤„ÇÑÂÅ•Â∫∑ÁÆ°ÁêÜ„ÅåÁõÆÁöÑ</span>
                            </label>
                        </li>
                    </ul>
                </div>
                
                <!-- Ë≥™Âïè2: ÁóáÁä∂ -->
                <div class="question-step" data-step="2">
                    <div class="question-title">‰∏ª„Å™ÊÇ©„Åø„ÇÑÁóáÁä∂„ÅØÔºü</div>
                    <ul class="options">
                        <li class="option">
                            <label>
                                <input type="radio" name="symptoms" value="mental">
                                <span>üòü Ê∞óÂàÜ„ÅÆËêΩ„Å°Ëæº„Åø„Éª‰∏çÂÆâ„Éª„Ç§„É©„Ç§„É©</span>
                            </label>
                        </li>
                        <li class="option">
                            <label>
                                <input type="radio" name="symptoms" value="physical">
                                <span>üò¥ È†≠Áóõ„ÉªÁñ≤Âä¥„ÉªËÉÉËÖ∏„ÅÆ‰∏çË™ø„ÉªÁú†„Çå„Å™„ÅÑ</span>
                            </label>
                        </li>
                        <li class="option">
                            <label>
                                <input type="radio" name="symptoms" value="workplace">
                                <span>üíº ËÅ∑Â†¥„ÅÆ‰∫∫ÈñìÈñ¢‰øÇ„Éª‰ªï‰∫ã„ÅÆÊÇ©„Åø</span>
                            </label>
                        </li>
                        <li class="option">
                            <label>
                                <input type="radio" name="symptoms" value="family">
                                <span>üè† ÂÆ∂Êóè„ÇÑÂÄã‰∫∫ÁöÑ„Å™ÂïèÈ°å</span>
                            </label>
                        </li>
                        <li class="option">
                            <label>
                                <input type="radio" name="symptoms" value="multiple">
                                <span>üîÑ Ë§áÊï∞„ÅÆÂïèÈ°å„ÅåÁµ°„ÅøÂêà„Å£„Å¶„ÅÑ„Çã</span>
                            </label>
                        </li>
                    </ul>
                </div>
                
                <!-- Ë≥™Âïè3: Áõ∏Ë´áÊñπÊ≥ï -->
                <div class="question-step" data-step="3">
                    <div class="question-title">Áõ∏Ë´áÊñπÊ≥ï„ÅÆÂ∏åÊúõ„ÅØÔºü</div>
                    <ul class="options">
                        <li class="option">
                            <label>
                                <input type="radio" name="preference" value="phone">
                                <span>üìû ÈõªË©±„ÅßÂåøÂêç„ÅßÁõ∏Ë´á„Åó„Åü„ÅÑ</span>
                            </label>
                        </li>
                        <li class="option">
                            <label>
                                <input type="radio" name="preference" value="face">
                                <span>üë• ÂØæÈù¢„Åß„Åò„Å£„Åè„ÇäË©±„Åó„Åü„ÅÑ</span>
                            </label>
                        </li>
                        <li class="option">
                            <label>
                                <input type="radio" name="preference" value="medical">
                                <span>üè• ÂåªÂ∏´„ÅÆË®∫ÂØü„ÇíÂèó„Åë„Åü„ÅÑ</span>
                            </label>
                        </li>
                        <li class="option">
                            <label>
                                <input type="radio" name="preference" value="online">
                                <span>üíª „Ç™„É≥„É©„Ç§„É≥„ÅßÊ∞óËªΩ„Å´</span>
                            </label>
                        </li>
                    </ul>
                </div>
                
                <!-- Ë≥™Âïè4: ÊôÇÈñìÂ∏Ø -->
                <div class="question-step" data-step="4">
                    <div class="question-title">Áõ∏Ë´áÂèØËÉΩ„Å™ÊôÇÈñìÂ∏Ø„ÅØÔºü</div>
                    <ul class="options">
                        <li class="option">
                            <label>
                                <input type="radio" name="timing" value="anytime">
                                <span>üåô „ÅÑ„Å§„Åß„ÇÇÔºà24ÊôÇÈñìÂØæÂøúÂ∏åÊúõÔºâ</span>
                            </label>
                        </li>
                        <li class="option">
                            <label>
                                <input type="radio" name="timing" value="business">
                                <span>üåÖ Âπ≥Êó•„ÅÆÊó•‰∏≠</span>
                            </label>
                        </li>
                        <li class="option">
                            <label>
                                <input type="radio" name="timing" value="evening">
                                <span>üåÜ Âπ≥Êó•„ÅÆÂ§ïÊñπ„ÉªÂ§úÈñì</span>
                            </label>
                        </li>
                        <li class="option">
                            <label>
                                <input type="radio" name="timing" value="weekend">
                                <span>üìÖ ÂúüÊó•„ÉªÁ•ùÊó•</span>
                            </label>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- „Éú„Çø„É≥„Ç®„É™„Ç¢ -->
            <div class="button-container">
                <button class="btn btn-back" id="backBtn" onclick="goBack()" disabled>
                    ‚Üê Ââç„ÅÆË≥™Âïè
                </button>
                <button class="btn btn-next" id="nextBtn" onclick="goNext()" disabled>
                    Ê¨°„ÅÆË≥™Âïè ‚Üí
                </button>
                <button class="btn btn-submit" id="submitBtn" onclick="submitForm()" style="display: none;" disabled>
                    üéØ Ë®∫Êñ≠ÁµêÊûú„ÇíË¶ã„Çã
                </button>
            </div>
            
            <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞ -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Ë®∫Êñ≠‰∏≠...</p>
            </div>
            
            <!-- ÁµêÊûúË°®Á§∫ -->
            <div class="result-card" id="result">
                <!-- ÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
            </div>
        </div>
    </div>

    <script>
        // Google Apps Script„ÅÆWeb„Ç¢„Éó„É™URL„ÇíË®≠ÂÆöÔºà„Çª„Éü„Ç≥„É≠„É≥„ÇíÂâäÈô§Ôºâ
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzU7LqheJw7k0efj8vYdPmmxBBSbUje1E4AGWKvqOqqs3buLh0aRD20eN_pS-DHuPlE/exec';
        
        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆÁä∂ÊÖãÁÆ°ÁêÜ
        let currentStep = 1;
        const totalSteps = 4;
        let answers = {};
        
        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            setupEventListeners();
        });
        
        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆË®≠ÂÆö
        function setupEventListeners() {
            // „É©„Ç∏„Ç™„Éú„Çø„É≥„ÅÆÂ§âÊõ¥„ÇíÁõ£Ë¶ñ
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    answers[this.name] = this.value;
                    updateButtons();
                });
            });
        }
        
        // „Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
        function updateButtons() {
            const currentQuestionStep = document.querySelector(`.question-step[data-step="${currentStep}"]`);
            const currentInput = currentQuestionStep.querySelector('input[type="radio"]:checked');
            
            // Ê¨°„Å∏„Éú„Çø„É≥„ÅÆÁä∂ÊÖã
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            if (currentInput) {
                if (currentStep < totalSteps) {
                    nextBtn.disabled = false;
                } else {
                    submitBtn.disabled = false;
                }
            } else {
                nextBtn.disabled = true;
                submitBtn.disabled = true;
            }
            
            // Êàª„Çã„Éú„Çø„É≥„ÅÆÁä∂ÊÖã
            document.getElementById('backBtn').disabled = currentStep === 1;
        }
        
        // Ê¨°„ÅÆË≥™Âïè„Å∏ÈÄ≤„ÇÄ
        function goNext() {
            if (currentStep < totalSteps) {
                // ÁèæÂú®„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇíÈùûË°®Á§∫
                document.querySelector(`.question-step[data-step="${currentStep}"]`).classList.remove('active');
                
                currentStep++;
                
                // Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇíË°®Á§∫
                document.querySelector(`.question-step[data-step="${currentStep}"]`).classList.add('active');
                
                updateProgress();
                updateButtons();
                
                // ÊúÄÂæå„ÅÆË≥™Âïè„ÅÆÂ†¥Âêà„ÅØ„Éú„Çø„É≥„ÇíÂàá„ÇäÊõø„Åà
                if (currentStep === totalSteps) {
                    document.getElementById('nextBtn').style.display = 'none';
                    document.getElementById('submitBtn').style.display = 'block';
                }
            }
        }
        
        // Ââç„ÅÆË≥™Âïè„Å´Êàª„Çã
        function goBack() {
            if (currentStep > 1) {
                // ÁèæÂú®„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇíÈùûË°®Á§∫
                document.querySelector(`.question-step[data-step="${currentStep}"]`).classList.remove('active');
                
                currentStep--;
                
                // Ââç„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇíË°®Á§∫
                document.querySelector(`.question-step[data-step="${currentStep}"]`).classList.add('active');
                
                updateProgress();
                updateButtons();
                
                // „Éú„Çø„É≥„ÅÆË°®Á§∫„ÇíÂÖÉ„Å´Êàª„Åô
                if (currentStep < totalSteps) {
                    document.getElementById('nextBtn').style.display = 'block';
                    document.getElementById('submitBtn').style.display = 'none';
                }
            }
        }
        
        // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„ÅÆÊõ¥Êñ∞
        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            
            document.getElementById('currentStep').textContent = currentStep;
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }
        
        // Ë®∫Êñ≠ÁµêÊûú„ÇíÈÄÅ‰ø°
        async function submitForm() {
            // „Åô„Åπ„Å¶„ÅÆË≥™Âïè„Å´ÂõûÁ≠î„Åï„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            const requiredFields = ['urgency', 'symptoms', 'preference', 'timing'];
            const missingFields = requiredFields.filter(field => !answers[field]);
            
            if (missingFields.length > 0) {
                alert('„Åô„Åπ„Å¶„ÅÆË≥™Âïè„Å´„ÅäÁ≠î„Åà„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
            document.getElementById('questionContainer').style.display = 'none';
            document.querySelector('.button-container').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
            document.getElementById('loading').classList.add('show');
            
            try {
                console.log('Ë®∫Êñ≠„É™„ÇØ„Ç®„Çπ„ÉàÈÄÅ‰ø°ÈñãÂßã');
                console.log('ÈÄÅ‰ø°„Éá„Éº„Çø:', { action: 'getDiagnosis', answers: answers });

                // Google Apps Script„Å´Ë®∫Êñ≠„É™„ÇØ„Ç®„Çπ„Éà„ÇíÈÄÅ‰ø°
                const response = await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    mode: 'cors',
                    body: JSON.stringify({
                        action: 'getDiagnosis',
                        answers: answers
                    })
                });
                
                console.log('„É¨„Çπ„Éù„É≥„Çπ„Çπ„ÉÜ„Éº„Çø„Çπ:', response.status);
                console.log('„É¨„Çπ„Éù„É≥„Çπ„Éò„ÉÉ„ÉÄ„Éº:', [...response.headers.entries()]);
                
                // „É¨„Çπ„Éù„É≥„Çπ„ÅÆÊ§úË®º
                if (!response.ok) {
                    throw new Error(`HTTP„Ç®„É©„Éº: ${response.status} ${response.statusText}`);
                }
                
                // Content-Type„ÅÆÁ¢∫Ë™ç
                const contentType = response.headers.get("content-type");
                if (!contentType || !contentType.includes("application/json")) {
                    console.warn("‰∫àÊúü„Åó„Å™„ÅÑContent-Type:", contentType);
                    // JSON„Åß„Å™„ÅÑÂ†¥Âêà„ÅØ„ÉÜ„Ç≠„Çπ„Éà„Å®„Åó„Å¶Ë™≠„ÅøËæº„Åø
                    const textResponse = await response.text();
                    console.log('„ÉÜ„Ç≠„Çπ„Éà„É¨„Çπ„Éù„É≥„Çπ:', textResponse);
                    throw new Error('„Çµ„Éº„Éê„Éº„Åã„ÇâJSON‰ª•Â§ñ„ÅÆ„É¨„Çπ„Éù„É≥„Çπ„ÅåËøî„Åï„Çå„Åæ„Åó„Åü: ' + textResponse);
                }
                
                const result = await response.json();
                console.log('Ëß£Êûê„Åï„Çå„Åü„É¨„Çπ„Éù„É≥„Çπ:', result);
                
                if (result.success) {
                    displayResult(result.recommendation);
                    if (result.dataSaved) {
                        console.log('„Éá„Éº„Çø„Åå„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´‰øùÂ≠ò„Åï„Çå„Åæ„Åó„Åü');
                    } else {
                        console.warn('„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    }
                } else {
                    throw new Error(result.error || 'Ë®∫Êñ≠„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
                
            } catch (error) {
                console.error('Ë®∫Êñ≠„Ç®„É©„ÉºË©≥Á¥∞:', error);
                console.error('„Ç®„É©„Éº„Çø„Ç§„Éó:', error.constructor.name);
                console.error('„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏:', error.message);
                
                document.getElementById('loading').classList.remove('show');
                
                // „Ç®„É©„Éº„ÅÆÁ®ÆÈ°û„Å´Âøú„Åò„Å¶„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂ§âÊõ¥
                let errorMessage = 'Ë®∫Êñ≠‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ';
                
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    errorMessage = '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                } else if (error.message.includes('HTTP„Ç®„É©„Éº')) {
                    errorMessage = '„Çµ„Éº„Éê„Éº„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Åó„Å∞„Çâ„ÅèÂæÖ„Å£„Å¶„Åã„ÇâÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ';
                } else if (error.message.includes('JSON')) {
                    errorMessage = '„Éá„Éº„Çø„ÅÆÂá¶ÁêÜ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ';
                }
                
                document.getElementById('result').innerHTML = `
                    <div class="error">
                        ${errorMessage}
                        <details style="margin-top: 10px;">
                            <summary>Ë©≥Á¥∞ÊÉÖÂ†±</summary>
                            <pre style="font-size: 12px; color: #666; margin-top: 5px;">${error.message}</pre>
                        </details>
                        <button class="restart-btn" onclick="restartDiagnosis()">ÊúÄÂàù„Åã„Çâ„ÇÑ„ÇäÁõ¥„Åô</button>
                    </div>
                `;
                document.getElementById('result').classList.add('show');
            }
        }
        
        // „Éá„Éê„ÉÉ„Ç∞Áî®„ÅÆÈñ¢Êï∞ÔºàÊú¨Áï™Áí∞Â¢É„Åß„ÅØÂâäÈô§„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ
        function debugGASConnection() {
            console.log('GAS URL:', GAS_WEB_APP_URL);
            console.log('„ÉÜ„Çπ„ÉàÊé•Á∂ö„ÇíÈñãÂßã...');
            
            fetch(GAS_WEB_APP_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain',
                },
                body: JSON.stringify({
                    action: 'test',
                    timestamp: new Date().toISOString()
                })
            })
            .then(response => {
                console.log('„ÉÜ„Çπ„ÉàÊé•Á∂öÁµêÊûú:', response.status);
                return response.text();
            })
            .then(text => {
                console.log('„ÉÜ„Çπ„Éà„É¨„Çπ„Éù„É≥„Çπ:', text);
                try {
                    const json = JSON.parse(text);
                    console.log('JSONËß£ÊûêÊàêÂäü:', json);
                } catch (e) {
                    console.log('JSONËß£ÊûêÂ§±Êïó„ÄÅ„ÉÜ„Ç≠„Çπ„Éà„Å®„Åó„Å¶Âá¶ÁêÜ:', text);
                }
            })
            .catch(error => {
                console.error('„ÉÜ„Çπ„ÉàÊé•Á∂ö„Ç®„É©„Éº:', error);
            });
        }
        
        // ÁµêÊûúË°®Á§∫
        function displayResult(recommendation) {
            document.getElementById('loading').classList.remove('show');
            
            let contactInfo = '';
            if (recommendation.contact.startsWith('http')) {
                contactInfo = `<a href="${recommendation.contact}" target="_blank" class="contact-btn" onclick="recordContactClick()">„Çµ„Ç§„Éà„ÇíÈñã„Åè</a>`;
            } else {
                contactInfo = `<strong>ÈÄ£Áµ°ÂÖàÔºö</strong> ${recommendation.contact}`;
            }
            
            let clinicsInfo = '';
            if (recommendation.clinics) {
                clinicsInfo = '<div class="contact-info"><strong>ÂåªÁôÇÊ©üÈñ¢‰∏ÄË¶ßÔºö</strong><br>';
                recommendation.clinics.forEach(clinic => {
                    clinicsInfo += `<div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                        <strong>${clinic.name}</strong><br>
                        ÈõªË©±: ${clinic.phone}<br>
                        ÊôÇÈñì: ${clinic.hours}
                    </div>`;
                });
                clinicsInfo += '</div>';
            }
            
            const resultHTML = `
                <div class="result-title">üéØ „ÅÇ„Å™„Åü„Å´„Åä„Åô„Åô„ÇÅ„ÅÆÁõ∏Ë´áÁ™ìÂè£</div>
                <div class="service-info">
                    <h3>${recommendation.name}</h3>
                    <p>${recommendation.description}</p>
                    <div class="contact-info">
                        ${contactInfo}
                        <br><strong>ÂØæÂøúÊôÇÈñìÔºö</strong> ${recommendation.hours}
                        <br><strong>„Çµ„Éº„Éì„ÇπÁ®ÆÂà•Ôºö</strong> ${recommendation.service_type}
                        <br><strong>ÁâπÂæ¥Ôºö</strong> ${recommendation.features.join('„ÄÅ')}
                    </div>
                    ${clinicsInfo}
                </div>
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                    <p><strong>üí° „ÅîÂà©Áî®„ÅÆ„Éí„É≥„ÉàÔºö</strong></p>
                    <p>Áõ∏Ë´á„ÅØÂãáÊ∞ó„ÅÆ„ÅÑ„Çã„Åì„Å®„Åß„Åô„Åå„ÄÅÂ∞ÇÈñÄÂÆ∂„Åå„ÅÇ„Å™„Åü„Çí„Çµ„Éù„Éº„Éà„Åó„Åæ„Åô„ÄÇ‰∏Ä‰∫∫„ÅßÊä±„ÅàËæº„Åæ„Åö„ÄÅ„Åæ„Åö„ÅØÊ∞óËªΩ„Å´„ÅîÈÄ£Áµ°„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="restart-btn" onclick="restartDiagnosis()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶Ë®∫Êñ≠„Åô„Çã</button>
                </div>
            `;
            
            document.getElementById('result').innerHTML = resultHTML;
            document.getElementById('result').classList.add('show');
        }
        
        // ÈÄ£Áµ°ÂÖà„ÇØ„É™„ÉÉ„ÇØ„ÅÆË®òÈå≤
        async function recordContactClick() {
            try {
                await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify({
                        action: 'recordContact',
                        answers: answers
                    })
                });
            } catch (error) {
                console.error('Contact tracking error:', error);
            }
        }
        
        // Ë®∫Êñ≠„Çí„ÇÑ„ÇäÁõ¥„Åô
        function restartDiagnosis